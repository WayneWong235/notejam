pipeline {
	agent any
	tools { nodejs "nodejs10.x" }
	
	stages {
		stage('Trigger') {
			steps {
				echo "trigger"
			}
		}

		stage('Install') {
			steps {
                sh 'npm config ls'
				sh '''
					cd express/notejam
					npm install
				'''
			}
		}

		stage('Build') {
			when { branch 'master' }
			steps { 
				sh '''
					cd express/notejam
					ls -l
					docker build -t waynewong/express:${BUILD_NUMBER} .
					withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'DOCKER_USER', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']]) {
						docker login --username $USERNAME --password $PASSWORD
					}
                    docker push waynewong/express:${env.BUILD_NUMBER}
				'''
			}
		}
	}
}