pipeline {
	agent any
	tools { nodejs "nodejs10.x" }
	
	stages {
		stage('Trigger') {
			steps {
				echo "trigger"
			}
		}

		stage('Build') {
			steps {
                sh 'npm config ls'
				sh '''
					cd express/notejam
					npm install
					docker -v
				'''
				script {
					if (env.BRANCH_NAME == 'master' || env.BRANCH_NAME == 'release') {
						sh '''
							docker build -t waynewong/express:${env.BUILD_NUMBER} .
							docker login --username $DOCKER_USER --password $DOCKER_PW
							docker push waynewong/express:${env.BUILD_NUMBER}
						'''
					}
				}
			}
		}

		stage('Test') {
			steps {
				echo "test"
			}
		}
	
		stage('Push') {
			steps {
				echo "push"
			}
		}
	}
}